---
interface Props {
  images: string[];
  lightboxGroup?: string;
}

const { images, lightboxGroup = "galeria" } = Astro.props;
const swiperId = `cies-swiper-${lightboxGroup}`;
---

<div class="cies-swiper-gallery-root">
  <div class="swiper cies-swiper-gallery" id={swiperId}>
    <div class="swiper-wrapper">
      {images.map((src, index) => (
        <div class="swiper-slide">
          <a
            href={src}
            data-lightbox={lightboxGroup}
            data-title={`Vista de la galer√≠a ${index + 1}`}
          >
            <div class="cies-swiper-thumb">
              <img
                src={src}
                alt={`Vista de la galer√≠a ${index + 1}`}
                loading="lazy"
              />
            </div>
          </a>
        </div>
      ))}
    </div>

    <!-- Flechas -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
</div>

<!-- üëá CAMBIO IMPORTANTE: quitamos is:inline y usamos define:vars -->
<script define:vars={{ swiperId }}>
  document.addEventListener("DOMContentLoaded", function () {
    const el = document.getElementById(swiperId);

    if (
      !el ||
      el.dataset.swiperInitialized === "true" ||
      typeof window.Swiper === "undefined"
    ) {
      return;
    }

    el.dataset.swiperInitialized = "true";

    new window.Swiper(el, {
      loop: true,
      spaceBetween: 12,
      slidesPerView: 2,
      navigation: {
        nextEl: el.querySelector(".swiper-button-next"),
        prevEl: el.querySelector(".swiper-button-prev"),
      },
      breakpoints: {
        576: { slidesPerView: 3 },
        768: { slidesPerView: 4 },
        992: { slidesPerView: 5 },
        1200: { slidesPerView: 6 },
      },
      autoplay: {
        delay: 4000,
        disableOnInteraction: false,
      },
    });
  });
</script>

<style>
  .cies-swiper-gallery-root {
    position: relative;
    padding-bottom: 1.5rem;
  }

  .cies-swiper-thumb {
    width: 100%;
    aspect-ratio: 1 / 1; /* cuadrado */
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    background: #f5f5f5;
  }

  .cies-swiper-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  :global(.cies-swiper-gallery-root .swiper-button-prev),
  :global(.cies-swiper-gallery-root .swiper-button-next) {
    color: #00a859;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);

  }


  /* √çcono */
  :global(.cies-swiper-gallery-root .swiper-button-prev .swiper-navigation-icon),
  :global(.cies-swiper-gallery-root .swiper-button-next .swiper-navigation-icon) {
    width: 10px;
    height: 18px;
  }

  /* Color del √≠cono */
  :global(.cies-swiper-gallery-root .swiper-button-prev .swiper-navigation-icon path),
  :global(.cies-swiper-gallery-root .swiper-button-next .swiper-navigation-icon path) {
    fill: #00a859;
  }
</style>
