---
import logo from "@assets/cies-logo.png";
import CiesNavbarItems from "@components/NavbarItems.astro";
import "@styles/views/navbar.css";
---

<header>
  <nav id="cies-nav" class="navbar fixed-top navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom shadow mb-3 d-none d-lg-flex">
    <div class="container-fluid d-flex flex-column align-items-center">
      <!-- Logo centrado inicial -->
      <a class="logo-wrapper-center" href="/">
        <img src={logo.src} alt="Logo Cies" class="logo-navbar" height="50" />
      </a>

      <!-- Logo scroll -->
      <a class="logo-wrapper-brand" href="/">
        <img src={logo.src} alt="Logo Cies" class="logo-navbar-brand" height="40" />
      </a>

      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target=".navbar-collapse"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
        <ul class="navbar-nav flex-grow-1">
          <CiesNavbarItems />
        </ul>
      </div>
    </div>
  </nav>

  <!-- Mobile -->
  <nav id="cies-nav-mobile" class="navbar bg-body-tertiary fixed-top shadow border-bottom d-flex d-lg-none">
    <div class="container-fluid">
      <a class="navbar-brand" href="/"><img src={logo.src} alt="Logo Cies" height="40" /></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header">
          <a class="navbar-brand" href="/"><img src={logo.src} alt="Logo Cies" height="40"  /></a>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
            <CiesNavbarItems />
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  // (function () {
  //   // Realiza el juego de imagenes al hacer scroll
  //   const THRESHOLD = 60;

  //   function update() {
  //     const nav = document.getElementById("cies-nav");
  //     if (!nav) return;

  //     const scrolled = window.scrollY > THRESHOLD;
  //     nav.classList.toggle("scrolled", scrolled);
  //   }

  //   //window.addEventListener("load", update, { once: true });
  //   document.addEventListener("DOMContentLoaded", update);
  //   window.addEventListener("scroll", update, { passive: true });
  // })();

  (function () {
    const THRESHOLD = 60;           // punto donde cambia el navbar
    const NAVBAR_BIG = 140;         // altura navbar normal
    const NAVBAR_SMALL = 60;        // altura navbar pequeña
    const MOBILE_BREAKPOINT = 992;  // igual que Bootstrap lg

    const nav = document.getElementById("cies-nav");
    const hero = document.querySelector(".hero-wrapper");

    if (!nav || !hero) return;

    function updateNavbar() {
      const scrolled = window.scrollY > THRESHOLD;
      nav.classList.toggle("scrolled", scrolled);
    }

    function updateHeroHeight() {
      // Mobile → hero pantalla completa
      if (window.innerWidth < MOBILE_BREAKPOINT) {
        hero.style.height = "100vh";
        return;
      }

      // Desktop → altura según estado actual del navbar
      const isScrolled = nav.classList.contains("scrolled");
      const currentHeight = isScrolled ? NAVBAR_SMALL : NAVBAR_BIG;

      hero.style.height = `calc(100vh - ${currentHeight}px)`;
    }

    function updateAll() {
      updateNavbar();
      updateHeroHeight();
    }

    document.addEventListener("DOMContentLoaded", updateAll);
    window.addEventListener("scroll", updateAll, { passive: true });
    window.addEventListener("resize", updateHeroHeight);

    // Ajuste extra por si estilos/carga tardan un poquito
    window.setTimeout(updateAll, 60);
  })();
</script>

</script>
